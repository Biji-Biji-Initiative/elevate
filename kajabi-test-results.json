{"level":"error","time":"2025-09-12T04:27:05.950Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"elevate-db","module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{},"error":{"name":"UnknownError","message":"\nInvalid `tx.kajabiEvent.create()` invocation in\n/Users/agent-[BASE64_REDACTED].ts:149:[PHONE_REDACTED]return await prisma.$transaction(async (tx) => {\n  147   // Deduplicate by event_id + tag\n  148   try {\n→ 149     await tx.kajabiEvent.create(\nUnique constraint failed on the fields: (`event_id`,`tag_name_norm`)","context":{"module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{}}},"msg":"Database error occurred"}
{"level":"info","time":"2025-09-12T04:27:05.951Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"kajabi-webhook","module":"kajabi-webhook","eventId":"kajabi_12345_67890","tagNorm":"learn_completed","meta":{},"msg":"Kajabi event deduplicated (create)"}
{"level":"error","time":"2025-09-12T04:27:06.115Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"elevate-db","module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{},"error":{"name":"UnknownError","message":"\nInvalid `tx.kajabiEvent.create()` invocation in\n/Users/agent-[BASE64_REDACTED].ts:149:[PHONE_REDACTED]return await prisma.$transaction(async (tx) => {\n  147   // Deduplicate by event_id + tag\n  148   try {\n→ 149     await tx.kajabiEvent.create(\nUnique constraint failed on the fields: (`event_id`,`tag_name_norm`)","context":{"module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{}}},"msg":"Database error occurred"}
{"level":"info","time":"2025-09-12T04:27:06.115Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"kajabi-webhook","module":"kajabi-webhook","eventId":"kajabi_duplicate_test","tagNorm":"learn_completed","meta":{},"msg":"Kajabi event deduplicated (create)"}
{"level":"error","time":"2025-09-12T04:27:06.134Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"elevate-db","module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{},"error":{"name":"UnknownError","message":"\nInvalid `tx.kajabiEvent.create()` invocation in\n/Users/agent-[BASE64_REDACTED].ts:149:[PHONE_REDACTED]return await prisma.$transaction(async (tx) => {\n  147   // Deduplicate by event_id + tag\n  148   try {\n→ 149     await tx.kajabiEvent.create(\nUnique constraint failed on the fields: (`event_id`,`tag_name_norm`)","context":{"module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{}}},"msg":"Database error occurred"}
{"level":"info","time":"2025-09-12T04:27:06.134Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"kajabi-webhook","module":"kajabi-webhook","eventId":"kajabi_duplicate_test","tagNorm":"learn_completed","meta":{},"msg":"Kajabi event deduplicated (create)"}
{"level":"error","time":"2025-09-12T04:27:06.233Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"elevate-db","module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{},"error":{"name":"UnknownError","message":"\nInvalid `tx.kajabiEvent.create()` invocation in\n/Users/agent-[BASE64_REDACTED].ts:149:[PHONE_REDACTED]return await prisma.$transaction(async (tx) => {\n  147   // Deduplicate by event_id + tag\n  148   try {\n→ 149     await tx.kajabiEvent.create(\nUnique constraint failed on the fields: (`event_id`,`tag_name_norm`)","context":{"module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{}}},"msg":"Database error occurred"}
{"level":"info","time":"2025-09-12T04:27:06.233Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"kajabi-webhook","module":"kajabi-webhook","eventId":"kajabi_user_not_found","tagNorm":"learn_completed","meta":{},"msg":"Kajabi event deduplicated (create)"}
{"level":"error","time":"2025-09-12T04:27:06.316Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"elevate-db","module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{},"error":{"name":"UnknownError","message":"\nInvalid `tx.kajabiEvent.create()` invocation in\n/Users/agent-[BASE64_REDACTED].ts:149:[PHONE_REDACTED]return await prisma.$transaction(async (tx) => {\n  147   // Deduplicate by event_id + tag\n  148   try {\n→ 149     await tx.kajabiEvent.create(\nUnique constraint failed on the fields: (`event_id`,`tag_name_norm`)","context":{"module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{}}},"msg":"Database error occurred"}
{"level":"info","time":"2025-09-12T04:27:06.316Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"kajabi-webhook","module":"kajabi-webhook","eventId":"kajabi_other_tag","tagNorm":"some_other_tag","meta":{},"msg":"Kajabi event deduplicated (create)"}
{"level":"warn","time":"2025-09-12T04:27:06.577Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"kajabi-webhook","module":"kajabi-webhook","issues":[{"received":"unknown.event","code":"invalid_enum_value","options":["contact.tagged","tag.added","tag.removed"],"path":["event_type"],"message":"Invalid enum value. Expected 'contact.tagged' | 'tag.added' | 'tag.removed', received 'unknown.event'"},{"code":"invalid_type","expected":"object","received":"undefined","path":["tag"],"message":"Required"}],"fallbackError":"Missing email or tag name in JSON:API payload","meta":{},"msg":"Invalid Kajabi webhook payload"}
{"level":"error","time":"2025-09-12T04:27:06.664Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"elevate-db","module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{},"error":{"name":"UnknownError","message":"\nInvalid `tx.kajabiEvent.create()` invocation in\n/Users/agent-[BASE64_REDACTED].ts:149:[PHONE_REDACTED]return await prisma.$transaction(async (tx) => {\n  147   // Deduplicate by event_id + tag\n  148   try {\n→ 149     await tx.kajabiEvent.create(\nUnique constraint failed on the fields: (`event_id`,`tag_name_norm`)","context":{"module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{}}},"msg":"Database error occurred"}
{"level":"info","time":"2025-09-12T04:27:06.664Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"kajabi-webhook","module":"kajabi-webhook","eventId":"kajabi_error_test","tagNorm":"learn_completed","meta":{},"msg":"Kajabi event deduplicated (create)"}
{"level":"error","time":"2025-09-12T04:27:06.740Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"elevate-db","module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{},"error":{"name":"UnknownError","message":"\nInvalid `tx.kajabiEvent.create()` invocation in\n/Users/agent-[BASE64_REDACTED].ts:149:[PHONE_REDACTED]return await prisma.$transaction(async (tx) => {\n  147   // Deduplicate by event_id + tag\n  148   try {\n→ 149     await tx.kajabiEvent.create(\nUnique constraint failed on the fields: (`event_id`,`tag_name_norm`)","context":{"module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{}}},"msg":"Database error occurred"}
{"level":"info","time":"2025-09-12T04:27:06.740Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"kajabi-webhook","module":"kajabi-webhook","eventId":"kajabi_race_condition","tagNorm":"learn_completed","meta":{},"msg":"Kajabi event deduplicated (create)"}
{"level":"error","time":"2025-09-12T04:27:06.759Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"elevate-db","module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{},"error":{"name":"UnknownError","message":"\nInvalid `tx.kajabiEvent.create()` invocation in\n/Users/agent-[BASE64_REDACTED].ts:149:[PHONE_REDACTED]return await prisma.$transaction(async (tx) => {\n  147   // Deduplicate by event_id + tag\n  148   try {\n→ 149     await tx.kajabiEvent.create(\nUnique constraint failed on the fields: (`event_id`,`tag_name_norm`)","context":{"module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{}}},"msg":"Database error occurred"}
{"level":"info","time":"2025-09-12T04:27:06.759Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"kajabi-webhook","module":"kajabi-webhook","eventId":"kajabi_race_condition","tagNorm":"learn_completed","meta":{},"msg":"Kajabi event deduplicated (create)"}
{"level":"error","time":"2025-09-12T04:27:06.760Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"elevate-db","module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{},"error":{"name":"UnknownError","message":"\nInvalid `tx.kajabiEvent.create()` invocation in\n/Users/agent-[BASE64_REDACTED].ts:149:[PHONE_REDACTED]return await prisma.$transaction(async (tx) => {\n  147   // Deduplicate by event_id + tag\n  148   try {\n→ 149     await tx.kajabiEvent.create(\nUnique constraint failed on the fields: (`event_id`,`tag_name_norm`)","context":{"module":"elevate-db","action":"database_error","target":"kajabiEvent.create","meta":{}}},"msg":"Database error occurred"}
{"level":"info","time":"2025-09-12T04:27:06.760Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"kajabi-webhook","module":"kajabi-webhook","eventId":"kajabi_race_condition","tagNorm":"learn_completed","meta":{},"msg":"Kajabi event deduplicated (create)"}
{"level":"warn","time":"2025-09-12T04:27:06.819Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"kajabi-webhook","module":"kajabi-webhook","issues":[{"code":"invalid_type","expected":"object","received":"undefined","path":["contact"],"message":"Required"},{"code":"invalid_type","expected":"object","received":"undefined","path":["tag"],"message":"Required"}],"fallbackError":"Missing email or tag name in JSON:API payload","meta":{},"msg":"Invalid Kajabi webhook payload"}
{"level":"warn","time":"2025-09-12T04:27:06.855Z","pid":82876,"hostname":"Gurpreets-iMac.local","environment":"test","module":"kajabi-webhook","module":"kajabi-webhook","meta":{},"msg":"Invalid JSON body for Kajabi webhook"}
{"numTotalTestSuites":2,"numPassedTestSuites":0,"numFailedTestSuites":2,"numPendingTestSuites":0,"numTotalTests":12,"numPassedTests":0,"numFailedTests":12,"numPendingTests":0,"numTodoTests":0,"snapshot":{"added":0,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0,"didUpdate":false},"startTime":1757651224644,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["Integration: Kajabi Webhook Integration"],"fullName":"Integration: Kajabi Webhook Integration should process learn completion webhook successfully","status":"failed","title":"should process learn completion webhook successfully","duration":609.360125,"failureMessages":["AssertionError: expected undefined to be 'kajabi_12345_67890' // Object.is equality\n    at /Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts:76:32\n    at file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"],"meta":{}},{"ancestorTitles":["Integration: Kajabi Webhook Integration"],"fullName":"Integration: Kajabi Webhook Integration should handle case-insensitive email matching","status":"failed","title":"should handle case-insensitive email matching","duration":83.34662500000013,"failureMessages":["AssertionError: expected 202 to be 200 // Object.is equality\n    at /Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts:159:29\n    at file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"],"meta":{}},{"ancestorTitles":["Integration: Kajabi Webhook Integration"],"fullName":"Integration: Kajabi Webhook Integration should handle duplicate webhooks idempotently","status":"failed","title":"should handle duplicate webhooks idempotently","duration":100.72404200000005,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'reason')\n    at /Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts:191:30\n    at file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"],"meta":{}},{"ancestorTitles":["Integration: Kajabi Webhook Integration"],"fullName":"Integration: Kajabi Webhook Integration should handle user not found gracefully","status":"failed","title":"should handle user not found gracefully","duration":106.95974999999999,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'success')\n    at /Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts:219:29\n    at file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"],"meta":{}},{"ancestorTitles":["Integration: Kajabi Webhook Integration"],"fullName":"Integration: Kajabi Webhook Integration should ignore non-LEARN_COMPLETED tags","status":"failed","title":"should ignore non-LEARN_COMPLETED tags","duration":59.26737500000013,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'success')\n    at /Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts:255:29\n    at file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"],"meta":{}},{"ancestorTitles":["Integration: Kajabi Webhook Integration"],"fullName":"Integration: Kajabi Webhook Integration should reject webhooks with invalid signatures","status":"failed","title":"should reject webhooks with invalid signatures","duration":133.40804200000002,"failureMessages":["AssertionError: expected 202 to be 401 // Object.is equality\n    at /Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts:274:29\n    at file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"],"meta":{}},{"ancestorTitles":["Integration: Kajabi Webhook Integration"],"fullName":"Integration: Kajabi Webhook Integration should handle missing webhook signatures","status":"failed","title":"should handle missing webhook signatures","duration":64.69245799999999,"failureMessages":["AssertionError: expected 202 to be 401 // Object.is equality\n    at /Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts:296:29\n    at file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"],"meta":{}},{"ancestorTitles":["Integration: Kajabi Webhook Integration"],"fullName":"Integration: Kajabi Webhook Integration should store unknown event types for audit","status":"failed","title":"should store unknown event types for audit","duration":80.423,"failureMessages":["AssertionError: expected 400 to be 200 // Object.is equality\n    at /Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts:315:29\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"],"meta":{}},{"ancestorTitles":["Integration: Kajabi Webhook Integration"],"fullName":"Integration: Kajabi Webhook Integration should handle webhook processing errors gracefully","status":"failed","title":"should handle webhook processing errors gracefully","duration":78.99125000000004,"failureMessages":["AssertionError: expected 200 to be 500 // Object.is equality\n    at /Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts:355:29\n    at file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"],"meta":{}},{"ancestorTitles":["Integration: Kajabi Webhook Integration"],"fullName":"Integration: Kajabi Webhook Integration should handle race conditions with concurrent webhooks","status":"failed","title":"should handle race conditions with concurrent webhooks","duration":97.65862500000026,"failureMessages":["AssertionError: expected [] to have a length of 1 but got +0\n    at Proxy.<anonymous> (file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1257:20)\n    at Proxy.<anonymous> (file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14)\n    at Proxy.methodWrapper (file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/chai@5.3.3/node_modules/chai/index.js:1686:25)\n    at /Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts:400:27\n    at file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"],"meta":{}},{"ancestorTitles":["Integration: Kajabi Webhook Integration"],"fullName":"Integration: Kajabi Webhook Integration should validate webhook payload structure","status":"failed","title":"should validate webhook payload structure","duration":44.55904099999998,"failureMessages":["AssertionError: expected 'An error occurred' to match /validation/i\n    at /Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts:416:24\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"],"meta":{}},{"ancestorTitles":["Integration: Kajabi Webhook Integration"],"fullName":"Integration: Kajabi Webhook Integration should handle malformed JSON gracefully","status":"failed","title":"should handle malformed JSON gracefully","duration":34.218832999999904,"failureMessages":["AssertionError: expected 'An error occurred' to match /invalid json/i\n    at /Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts:436:24\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///Users/agent-g/elevate/elevate/node_modules/.pnpm/@vitest+runner@3.2.4/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20"],"meta":{}}],"startTime":1757651225368,"endTime":1757651226862.2188,"status":"failed","message":"","name":"/Users/agent-g/elevate/elevate/tests/integration/02-kajabi-webhook-integration.test.ts"}]}
